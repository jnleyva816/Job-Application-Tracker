<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job URL Structure Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .input-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 1rem;
        }
        
        .url-input-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        input[type="url"] {
            flex: 1;
            padding: 15px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="url"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .sample-urls {
            margin-top: 20px;
        }
        
        .sample-urls h3 {
            margin-bottom: 15px;
            color: #555;
        }
        
        .sample-url-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }
        
        .sample-url {
            padding: 12px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .sample-url:hover {
            background: #e9ecef;
            border-color: #667eea;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 20px 0;
            display: none;
        }
        
        .results {
            margin-top: 30px;
            display: none;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            background: white;
            border-bottom-color: #667eea;
            color: #667eea;
        }
        
        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 400px;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .result-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 600;
        }
        
        .result-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .result-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .status-icon.success {
            background: #28a745;
        }
        
        .status-icon.error {
            background: #dc3545;
        }
        
        .parsed-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .field-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .field-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }
        
        .field-value {
            font-size: 16px;
            color: #333;
            word-wrap: break-word;
        }
        
        .field-value.empty {
            color: #6c757d;
            font-style: italic;
        }
        
        .field-value.compensation {
            color: #28a745;
            font-weight: 600;
        }
        
        .field-value.success {
            color: #28a745;
            font-weight: 600;
        }
        
        .field-value.warning {
            color: #ffc107;
            font-weight: 600;
        }
        
        .field-value.error {
            color: #dc3545;
            font-weight: 600;
        }
        
        .description-section {
            grid-column: 1 / -1;
        }
        
        .description-content {
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .raw-html-section {
            position: relative;
        }
        
        .html-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .html-stats {
            font-size: 14px;
            color: #6c757d;
        }
        
        .copy-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #5a6fd8;
        }
        
        .html-content {
            width: 100%;
            height: 500px;
            padding: 15px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            resize: vertical;
            background: #f8f9fa;
            overflow: auto;
        }
        
        .metadata {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .metadata-item {
            background: #e9ecef;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: #495057;
        }
        
        .compensation {
            font-size: 18px;
            font-weight: 600;
            color: #28a745;
        }
        
        .analysis-data {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        .analysis-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .analysis-section h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }
        
        .selector-result {
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #e9ecef;
        }
        
        .selector-result.found {
            border-left-color: #28a745;
        }
        
        .selector-result.not-found {
            border-left-color: #dc3545;
        }
        
        .selector-name {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .selector-value {
            color: #666;
            word-wrap: break-word;
        }
        
        .selector-value.found {
            color: #28a745;
            font-weight: 500;
        }
        
        .selector-value.not-found {
            color: #dc3545;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .url-input-container {
                flex-direction: column;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .parsed-data {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Job URL Structure Tester</h1>
            <p>Test job URL scraping and view both parsed data and raw HTML</p>
        </div>
        
        <div class="input-section">
            <div class="form-group">
                <label for="url-input">Job Posting URL</label>
                <div class="url-input-container">
                    <input 
                        type="url" 
                        id="url-input" 
                        placeholder="Enter any job posting URL (LinkedIn, Indeed, company career pages, etc.)"
                        autocomplete="url"
                    />
                    <button class="btn btn-primary" onclick="scrapeUrl()" id="scrape-btn">
                        üöÄ Scrape URL
                    </button>
                </div>
            </div>
            
            <div class="sample-urls">
                <h3>Sample URLs to Test</h3>
                <div class="sample-url-grid">
                    <div class="sample-url" onclick="setUrl('https://jobs.lever.co/example')">
                        üíº Lever Example
                    </div>
                    <div class="sample-url" onclick="setUrl('https://apply.workable.com/example/')">
                        üîß Workable Example
                    </div>
                    <div class="sample-url" onclick="setUrl('https://boards.greenhouse.io/example')">
                        üå± Greenhouse Example
                    </div>
                    <div class="sample-url" onclick="setUrl('https://careers.microsoft.com/global/en/job/1818936')">
                        üíª Microsoft Job (JS Required)
                    </div>
                    <div class="sample-url" onclick="setUrl('https://careers.microsoft.com/us/en')">
                        üíª Microsoft Careers (JS Required)
                    </div>
                    <div class="sample-url" onclick="setUrl('https://jobs.apple.com/us/search')">
                        üçé Apple Jobs (JS Required)
                    </div>
                    <div class="sample-url" onclick="setUrl('https://httpbin.org/html')">
                        üß™ Test HTML Page
                    </div>
                    <div class="sample-url" onclick="setUrl('https://example.org')">
                        üìÑ Example.org
                    </div>
                    <div class="sample-url" onclick="setUrl('https://httpbin.org/json')">
                        üìä JSON Test Page
                    </div>
                </div>
                <p style="margin-top: 10px; font-size: 14px; color: #6c757d;">
                    <em>Note: For best results, use actual job posting URLs from company career pages</em>
                </p>
            </div>
        </div>
        
        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Scraping URL and analyzing content...</p>
        </div>
        
        <div id="error" class="error"></div>
        
        <div id="results" class="results">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('parsed')" id="parsed-tab">
                    üìä Parsed Job Data
                </button>
                <button class="tab" onclick="switchTab('raw')" id="raw-tab">
                    üìÑ Plain Text Content
                </button>
                <button class="tab" onclick="switchTab('analysis')" id="analysis-tab">
                    üîç URL Analysis
                </button>
                <button class="tab" onclick="switchTab('javascript')" id="javascript-tab">
                    ‚ö° JavaScript Test
                </button>
                <button class="tab" onclick="switchTab('microsoft')" id="microsoft-tab">
                    üíª Microsoft Test
                </button>
            </div>
            
            <div class="tab-content">
                <div id="parsed-panel" class="tab-panel active">
                    <div id="parsed-status" class="result-status">
                        <div class="status-icon"></div>
                        <span id="parsed-message"></span>
                    </div>
                    
                    <div id="metadata" class="metadata"></div>
                    
                    <div id="parsed-content" class="parsed-data"></div>
                </div>
                
                <div id="raw-panel" class="tab-panel">
                    <div id="raw-status" class="result-status">
                        <div class="status-icon"></div>
                        <span id="raw-message"></span>
                    </div>
                    
                    <div class="raw-html-section">
                        <div class="html-header">
                            <div id="html-stats" class="html-stats"></div>
                            <button class="copy-btn" onclick="copyHtml()" id="copy-btn">
                                üìã Copy HTML
                            </button>
                        </div>
                        <textarea id="html-content" class="html-content" readonly placeholder="Raw HTML content will appear here..."></textarea>
                    </div>
                </div>
                
                <div id="analysis-panel" class="tab-panel">
                    <div id="analysis-status" class="result-status">
                        <div class="status-icon"></div>
                        <span id="analysis-message"></span>
                    </div>
                    
                    <div id="analysis-content" class="analysis-data"></div>
                </div>
                
                <div id="javascript-panel" class="tab-panel">
                    <div id="javascript-status" class="result-status">
                        <div class="status-icon"></div>
                        <span id="javascript-message"></span>
                    </div>
                    
                    <div id="javascript-content" class="analysis-data"></div>
                </div>
                
                <div id="microsoft-panel" class="tab-panel">
                    <div id="microsoft-status" class="result-status">
                        <div class="status-icon"></div>
                        <span id="microsoft-message"></span>
                    </div>
                    
                    <div id="microsoft-content" class="analysis-data"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let activeTab = 'parsed';
        let currentData = {};

        function setUrl(url) {
            document.getElementById('url-input').value = url;
        }

        function switchTab(tab) {
            // Update active tab
            activeTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
            
            // Update tab panels
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            document.getElementById(tab + '-panel').classList.add('active');
        }

        async function scrapeUrl() {
            const url = document.getElementById('url-input').value.trim();
            
            if (!url) {
                showError('Please enter a URL');
                return;
            }

            showLoading();
            
            try {
                // Use the proper job parsing endpoint that includes all parsers (Meta, Greenhouse, Generic)
                const [parseResponse, plainTextResponse, analysisResponse, javascriptResponse, microsoftResponse] = await Promise.all([
                    fetch('/api/debug/parse-job', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    }),
                    fetch('/api/debug/plain-text', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    }),
                    fetch('/api/debug/analyze-url', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    }),
                    fetch('/api/debug/test-javascript-rendering', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    }),
                    fetch('/api/debug/test-microsoft-parser', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url })
                    })
                ]);

                const parseData = await parseResponse.json();
                const plainTextData = await plainTextResponse.json();
                const analysisData = await analysisResponse.json();
                const javascriptData = await javascriptResponse.json();
                const microsoftData = await microsoftResponse.json();

                // Use the actual parse result from the job parsing service
                currentData = {
                    parsed: parseData,
                    raw: plainTextData,
                    url: url,
                    analysis: analysisData,
                    javascript: javascriptData,
                    microsoft: microsoftData
                };

                displayResults();
                showResults();

            } catch (error) {
                showError('Error scraping URL: ' + error.message);
            }
        }

        function extractBestValue(selectorResults) {
            if (!selectorResults) return null;
            
            for (const [selector, result] of Object.entries(selectorResults)) {
                if (result && result !== 'NOT FOUND' && result.trim()) {
                    return result.trim();
                }
            }
            return null;
        }

        function displayResults() {
            displayParsedData(currentData.parsed);
            displayRawHtml(currentData.raw);
            displayAnalysisData(currentData.analysis);
            displayJavaScriptData(currentData.javascript);
            displayMicrosoftData(currentData.microsoft);
        }

        function displayParsedData(data) {
            const statusEl = document.getElementById('parsed-status');
            const messageEl = document.getElementById('parsed-message');
            const metadataEl = document.getElementById('metadata');
            const contentEl = document.getElementById('parsed-content');

            // Update status
            if (data.successful) {
                statusEl.className = 'result-status success';
                statusEl.querySelector('.status-icon').className = 'status-icon success';
                messageEl.textContent = 'Successfully parsed job data';
            } else {
                statusEl.className = 'result-status error';
                statusEl.querySelector('.status-icon').className = 'status-icon error';
                messageEl.textContent = data.errorMessage || 'Failed to parse job data';
            }

            // Update metadata
            let metadataHtml = '';
            if (data.source) {
                metadataHtml += `<div class="metadata-item">Source: ${data.source}</div>`;
            }
            if (data.originalUrl) {
                metadataHtml += `<div class="metadata-item">URL: ${new URL(data.originalUrl).hostname}</div>`;
            }
            metadataEl.innerHTML = metadataHtml;

            // Update content
            if (data.successful) {
                contentEl.innerHTML = `
                    <div class="field-group">
                        <div class="field-label">Job Title</div>
                        <div class="field-value ${!data.jobTitle ? 'empty' : ''}">${data.jobTitle || 'Not found'}</div>
                    </div>
                    <div class="field-group">
                        <div class="field-label">Company</div>
                        <div class="field-value ${!data.company ? 'empty' : ''}">${data.company || 'Not found'}</div>
                    </div>
                    <div class="field-group">
                        <div class="field-label">Location</div>
                        <div class="field-value ${!data.location ? 'empty' : ''}">${data.location || 'Not found'}</div>
                    </div>
                    <div class="field-group">
                        <div class="field-label">Compensation</div>
                        <div class="field-value ${!data.compensation ? 'empty' : 'compensation'}">${formatCompensation(data.compensation, data.compensationType)}</div>
                    </div>
                    <div class="field-group">
                        <div class="field-label">Experience Level</div>
                        <div class="field-value ${!data.experienceLevel ? 'empty' : ''}">${data.experienceLevel || 'Not specified'}</div>
                    </div>
                    <div class="field-group description-section">
                        <div class="field-label">Job Description</div>
                        <div class="description-content">${data.description || 'No description found'}</div>
                    </div>
                `;
            } else {
                contentEl.innerHTML = `
                    <div class="field-group">
                        <div class="field-label">Error Details</div>
                        <div class="field-value">${data.errorMessage || 'Unknown error occurred'}</div>
                    </div>
                `;
            }
        }

        function displayRawHtml(data) {
            const statusEl = document.getElementById('raw-status');
            const messageEl = document.getElementById('raw-message');
            const statsEl = document.getElementById('html-stats');
            const contentEl = document.getElementById('html-content');

            // Update status
            if (data.successful) {
                statusEl.className = 'result-status success';
                statusEl.querySelector('.status-icon').className = 'status-icon success';
                messageEl.textContent = 'Successfully retrieved plain text content';
            } else {
                statusEl.className = 'result-status error';
                statusEl.querySelector('.status-icon').className = 'status-icon error';
                messageEl.textContent = data.errorMessage || 'Failed to retrieve content';
            }

            // Update content
            if (data.successful && data.plainText) {
                const textLength = data.plainText.length;
                statsEl.textContent = `Plain Text Size: ${textLength.toLocaleString()} characters | Title: ${data.title || 'No title'}`;
                contentEl.value = data.plainText;
            } else if (data.successful && data.rawHtml) {
                // Fallback for old raw HTML format
                const htmlLength = data.rawHtml.length;
                statsEl.textContent = `HTML Size: ${htmlLength.toLocaleString()} characters`;
                contentEl.value = data.rawHtml;
            } else {
                statsEl.textContent = 'No content available';
                contentEl.value = data.errorMessage || 'Failed to retrieve content';
            }
        }

        function displayAnalysisData(data) {
            const statusEl = document.getElementById('analysis-status');
            const messageEl = document.getElementById('analysis-message');
            const contentEl = document.getElementById('analysis-content');

            // Update status
            if (data && data.url) {
                statusEl.className = 'result-status success';
                statusEl.querySelector('.status-icon').className = 'status-icon success';
                messageEl.textContent = 'Successfully analyzed URL structure';
            } else {
                statusEl.className = 'result-status error';
                statusEl.querySelector('.status-icon').className = 'status-icon error';
                messageEl.textContent = 'Failed to analyze URL';
                return;
            }

            // Build analysis content
            let html = '<div class="analysis-data">';

            // Job Title Selectors
            html += createAnalysisSection('Job Title Selectors', data.jobTitleSelectors);
            
            // Company Selectors
            html += createAnalysisSection('Company Selectors', data.companySelectors);
            
            // Location Selectors
            html += createAnalysisSection('Location Selectors', data.locationSelectors);
            
            // Compensation Selectors
            html += createAnalysisSection('Compensation Selectors', data.compensationSelectors);
            
            // Description Selectors
            if (data.descriptionSelectors) {
                html += '<div class="analysis-section">';
                html += '<h3>Description Selectors</h3>';
                for (const [selector, result] of Object.entries(data.descriptionSelectors)) {
                    const found = (typeof result === 'object' && result.found) || result !== 'NOT FOUND';
                    html += `<div class="selector-result ${found ? 'found' : 'not-found'}">`;
                    html += `<div class="selector-name">${escapeHtml(selector)}</div>`;
                    if (typeof result === 'object' && result.found) {
                        html += `<div class="selector-value found">FOUND (${result.length} chars): ${escapeHtml(result.preview)}</div>`;
                    } else {
                        html += `<div class="selector-value not-found">NOT FOUND</div>`;
                    }
                    html += '</div>';
                }
                html += '</div>';
            }

            html += '</div>';
            contentEl.innerHTML = html;
        }

        function createAnalysisSection(title, selectors) {
            if (!selectors) return '';
            
            let html = '<div class="analysis-section">';
            html += `<h3>${title}</h3>`;
            
            for (const [selector, result] of Object.entries(selectors)) {
                const found = result && result !== 'NOT FOUND';
                html += `<div class="selector-result ${found ? 'found' : 'not-found'}">`;
                html += `<div class="selector-name">${escapeHtml(selector)}</div>`;
                html += `<div class="selector-value ${found ? 'found' : 'not-found'}">${escapeHtml(result)}</div>`;
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatCompensation(amount, type) {
            if (!amount) return 'Not specified';
            
            const formatter = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0,
            });

            const formatted = formatter.format(amount);
            return type ? `${formatted} ${type.toLowerCase()}` : formatted;
        }

        function copyHtml() {
            const htmlContent = document.getElementById('html-content');
            htmlContent.select();
            htmlContent.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const btn = document.getElementById('copy-btn');
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            document.getElementById('scrape-btn').disabled = true;
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('scrape-btn').disabled = false;
        }

        function showError(message) {
            hideLoading();
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            document.getElementById('results').style.display = 'none';
        }

        function showResults() {
            hideLoading();
            document.getElementById('error').style.display = 'none';
            document.getElementById('results').style.display = 'block';
        }

        function displayJavaScriptData(data) {
            const statusEl = document.getElementById('javascript-status');
            const messageEl = document.getElementById('javascript-message');
            const contentEl = document.getElementById('javascript-content');

            // Update status
            if (data && data.url) {
                statusEl.className = 'result-status success';
                statusEl.querySelector('.status-icon').className = 'status-icon success';
                messageEl.textContent = 'JavaScript rendering capabilities tested';
            } else {
                statusEl.className = 'result-status error';
                statusEl.querySelector('.status-icon').className = 'status-icon error';
                messageEl.textContent = 'Failed to test JavaScript rendering';
                return;
            }

            // Build content
            let html = '<div class="analysis-data">';
            
            // JavaScript Availability
            html += '<div class="analysis-section">';
            html += '<h3>JavaScript Rendering Status</h3>';
            html += `<div class="field-group">`;
            html += `<div class="field-label">JavaScript Rendering Available</div>`;
            html += `<div class="field-value ${data.jsRenderingAvailable ? 'success' : 'warning'}">${data.jsRenderingAvailable ? '‚úÖ Available' : '‚ùå Not Available'}</div>`;
            html += `</div>`;
            html += `<div class="field-group">`;
            html += `<div class="field-label">URL Likely Requires JavaScript</div>`;
            html += `<div class="field-value ${data.likelyRequiresJs ? 'warning' : 'success'}">${data.likelyRequiresJs ? '‚ö†Ô∏è Yes' : '‚úÖ No'}</div>`;
            html += `</div>`;
            html += '</div>';

            // Static HTML Results
            if (data.staticFetchSuccess !== undefined) {
                html += '<div class="analysis-section">';
                html += '<h3>Static HTML Results</h3>';
                html += `<div class="field-group">`;
                html += `<div class="field-label">Fetch Success</div>`;
                html += `<div class="field-value ${data.staticFetchSuccess ? 'success' : 'error'}">${data.staticFetchSuccess ? '‚úÖ Success' : '‚ùå Failed'}</div>`;
                html += `</div>`;
                if (data.staticFetchSuccess) {
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Element Count</div>`;
                    html += `<div class="field-value">${data.staticElementCount || 'N/A'}</div>`;
                    html += `</div>`;
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Text Length</div>`;
                    html += `<div class="field-value">${data.staticTextLength || 'N/A'} characters</div>`;
                    html += `</div>`;
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Title</div>`;
                    html += `<div class="field-value">${escapeHtml(data.staticTitle || 'N/A')}</div>`;
                    html += `</div>`;
                } else if (data.staticErrorMessage) {
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Error</div>`;
                    html += `<div class="field-value error">${escapeHtml(data.staticErrorMessage)}</div>`;
                    html += `</div>`;
                }
                html += '</div>';
            }

            // JavaScript Results
            if (data.jsRenderingAvailable) {
                html += '<div class="analysis-section">';
                html += '<h3>JavaScript Rendering Results</h3>';
                html += `<div class="field-group">`;
                html += `<div class="field-label">Fetch Success</div>`;
                html += `<div class="field-value ${data.jsFetchSuccess ? 'success' : 'error'}">${data.jsFetchSuccess ? '‚úÖ Success' : '‚ùå Failed'}</div>`;
                html += `</div>`;
                if (data.jsFetchSuccess) {
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Element Count</div>`;
                    html += `<div class="field-value">${data.jsElementCount || 'N/A'}</div>`;
                    html += `</div>`;
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Text Length</div>`;
                    html += `<div class="field-value">${data.jsTextLength || 'N/A'} characters</div>`;
                    html += `</div>`;
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">JavaScript Produced Better Results</div>`;
                    html += `<div class="field-value ${data.javascriptProducedBetterResults ? 'success' : 'warning'}">${data.javascriptProducedBetterResults ? '‚úÖ Yes' : '‚ö†Ô∏è No'}</div>`;
                    html += `</div>`;
                } else if (data.jsErrorMessage) {
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Error</div>`;
                    html += `<div class="field-value error">${escapeHtml(data.jsErrorMessage)}</div>`;
                    html += `</div>`;
                }
                html += '</div>';
            }

            html += '</div>';
            contentEl.innerHTML = html;
        }

        function displayMicrosoftData(data) {
            const statusEl = document.getElementById('microsoft-status');
            const messageEl = document.getElementById('microsoft-message');
            const contentEl = document.getElementById('microsoft-content');

            // Update status
            if (data && data.url) {
                statusEl.className = 'result-status success';
                statusEl.querySelector('.status-icon').className = 'status-icon success';
                messageEl.textContent = 'Microsoft parser tested';
            } else {
                statusEl.className = 'result-status error';
                statusEl.querySelector('.status-icon').className = 'status-icon error';
                messageEl.textContent = 'Failed to test Microsoft parser';
                return;
            }

            // Build content
            let html = '<div class="analysis-data">';
            
            // URL Check
            html += '<div class="analysis-section">';
            html += '<h3>URL Analysis</h3>';
            html += `<div class="field-group">`;
            html += `<div class="field-label">Is Microsoft URL</div>`;
            html += `<div class="field-value ${data.isMicrosoftUrl ? 'success' : 'warning'}">${data.isMicrosoftUrl ? '‚úÖ Yes' : '‚ö†Ô∏è No'}</div>`;
            html += `</div>`;
            html += `<div class="field-group">`;
            html += `<div class="field-label">JavaScript Rendering Available</div>`;
            html += `<div class="field-value ${data.jsRenderingAvailable ? 'success' : 'warning'}">${data.jsRenderingAvailable ? '‚úÖ Available' : '‚ùå Not Available'}</div>`;
            html += `</div>`;
            html += '</div>';

            // Parse Results
            html += '<div class="analysis-section">';
            html += '<h3>Parse Results</h3>';
            html += `<div class="field-group">`;
            html += `<div class="field-label">Parse Success</div>`;
            html += `<div class="field-value ${data.parseSuccessful ? 'success' : 'error'}">${data.parseSuccessful ? '‚úÖ Success' : '‚ùå Failed'}</div>`;
            html += `</div>`;
            
            if (data.parseSuccessful) {
                html += `<div class="field-group">`;
                html += `<div class="field-label">Job Title</div>`;
                html += `<div class="field-value ${data.jobTitle ? '' : 'empty'}">${escapeHtml(data.jobTitle || 'Not found')}</div>`;
                html += `</div>`;
                html += `<div class="field-group">`;
                html += `<div class="field-label">Company</div>`;
                html += `<div class="field-value ${data.company ? '' : 'empty'}">${escapeHtml(data.company || 'Not found')}</div>`;
                html += `</div>`;
                html += `<div class="field-group">`;
                html += `<div class="field-label">Location</div>`;
                html += `<div class="field-value ${data.location ? '' : 'empty'}">${escapeHtml(data.location || 'Not found')}</div>`;
                html += `</div>`;
                html += `<div class="field-group">`;
                html += `<div class="field-label">Compensation</div>`;
                html += `<div class="field-value ${data.compensation ? 'compensation' : 'empty'}">${data.compensation ? '$' + data.compensation.toLocaleString() : 'Not found'}</div>`;
                html += `</div>`;
                html += `<div class="field-group">`;
                html += `<div class="field-label">Source Parser</div>`;
                html += `<div class="field-value">${escapeHtml(data.source || 'Unknown')}</div>`;
                html += `</div>`;
                if (data.descriptionLength) {
                    html += `<div class="field-group">`;
                    html += `<div class="field-label">Description Length</div>`;
                    html += `<div class="field-value">${data.descriptionLength} characters</div>`;
                    html += `</div>`;
                }
                if (data.descriptionPreview) {
                    html += `<div class="field-group description-section">`;
                    html += `<div class="field-label">Description Preview</div>`;
                    html += `<div class="description-content">${escapeHtml(data.descriptionPreview)}</div>`;
                    html += `</div>`;
                }
            } else if (data.errorMessage) {
                html += `<div class="field-group">`;
                html += `<div class="field-label">Error Message</div>`;
                html += `<div class="field-value error">${escapeHtml(data.errorMessage)}</div>`;
                html += `</div>`;
            }
            
            html += '</div>';
            html += '</div>';
            contentEl.innerHTML = html;
        }

        // Add enter key support
        document.getElementById('url-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                scrapeUrl();
            }
        });

        // Focus on URL input when page loads
        window.addEventListener('load', function() {
            document.getElementById('url-input').focus();
        });
    </script>
</body>
</html> 